<!DOCTYPE html>
<html>
  <head>
    <title>moodio</title>
    <script type="text/javascript" charset="utf-8" src="jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="jquery.animate-colors.js"></script>
    <script type="text/javascript" charset="utf-8">
      var apiBaseUrl  = null;
      var username    = "1234567890";

      var lights      = [];
      
      var colorCodes = {
        "orange": 5000,
        "blue": 46920,
        "white": 0,
        "red": 500,
        "black": 0,
        "purple": 51920,
        "pink": 56100,
        "yellow": 12750
      }
      
      function makeScene(hue, brightness, saturation, transitiontime) {
        return {
          "hue": hue, // 0-65535
          "bri": brightness, // The brightness value to set the light to. value: 0-255
          "sat": saturation, // Saturation of the light. 0 (255) - 255 (colored)
          "transitiontime": transitiontime, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
          "effect": "none", // none, colorloop
          "alert": "none" // none, select (blinking), lselect (breath)
        }
      }
      
      var scenes      = {
        "orange": { 
          name: "Orange",
          lightState: {
            "hue": 5000, // 0-65535
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "blue": { 
          name: "Blue",
          lightState: {
            "hue": 46920, // 0-65535
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "white": { 
          name: "White",
          lightState: {
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 0, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "red": { 
          name: "Red",
          lightState: {
            "hue": 500,
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "black": { 
          name: "Black",
          lightState: {
            "hue": 500,
            "bri": 0, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "purple": { 
          name: "Purple",
          lightState: {
            "hue": 51920,
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "pink": { 
          name: "Pink",
          lightState: {
            "hue": 56100,
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        },
        "yellow": { 
          name: "Yellow",
          lightState: {
            "hue": 12750,
            "bri": 255, // The brightness value to set the light to. value: 0-255
            "sat": 255, // Saturation of the light. 0 (255) - 255 (colored)
            "transitiontime": 5, // The duration of the transition from the light’s current state to the new state (10 == 1 sec)
            "effect": "none", // none, colorloop
            "alert": "none" // none, select (blinking), lselect (breath)
          }
        }
        
      };

      // onLoad
      $.getJSON("https://www.meethue.com/api/nupnp", function(data) {
        var internalIpAddress = data[0].internalipaddress;
        apiBaseUrl = "http://" + internalIpAddress + "/api/" + username;
        console.log("onLoad - api url: " + apiBaseUrl);

        getLights();
        
        setLightState(1, { on: false, hue: 46920, bri: 000, sat: 255, fade: 0 });
        setLightState(2, { on: false, hue: 46920, bri: 000, sat: 255, fade: 0 });
        
        setTimeout(function(){
          $("audio").get(0).play();
        }, 1000) 
        
        setTimeout(function(){
          setLightState(1, { on: true, hue: 46920, bri: 000, sat: 255, fade: 10 });
          setLightState(2, { on: true, hue: 46920, bri: 000, sat: 255, fade: 10 });
        }, 2000) 
        
      });

      var getLights = function() {
        $.getJSON(apiBaseUrl, function(data) {
          lights = data["lights"];
        });
      };

      var setLightState = function(lightId, lightState) {
        var apiUrl = apiBaseUrl + "/lights/" + lightId + "/state";
        // console.log("setLightState - lightId: " + lightId + ", lightState: " + JSON.stringify(lightState) + ", apiUrl: " + apiUrl);

        $.ajax({
          url:  apiUrl,
          type: "PUT",
          data: JSON.stringify(lightState)
          // success: function(response) { }
        });
      };

    </script>
    <script type="text/javascript" charset="utf-8">
      $(function() {
        var colors = {
          0000: { primary: { hue: 46920, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 000, sat: 255, fade: 10 }, processed: false }, // rot, blau
          0500: { primary: { hue: 46920, bri: 050, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 050, sat: 255, fade: 10 }, processed: false }, // rot, blau
          1000: { primary: { hue: 46920, bri: 080, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 130, sat: 255, fade: 10 }, processed: false }, // rot, blau
          1500: { primary: { hue: 46920, bri: 020, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 020, sat: 255, fade: 10 }, processed: false }, // rot, blau
          2000: { primary: { hue: 46920, bri: 090, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 090, sat: 255, fade: 10 }, processed: false }, // rot, blau
          2500: { primary: { hue: 46920, bri: 030, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 030, sat: 255, fade: 10 }, processed: false }, // rot, blau
          3000: { primary: { hue: 46920, bri: 040, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 040, sat: 255, fade: 10 }, processed: false }, // rot, blau
          3500: { primary: { hue: 46920, bri: 010, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 010, sat: 255, fade: 10 }, processed: false }, // rot, blau
          4000: { primary: { hue: 46920, bri: 040, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 130, sat: 255, fade: 10 }, processed: false }, // rot, blau
          4500: { primary: { hue: 46920, bri: 020, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 020, sat: 255, fade: 10 }, processed: false }, // rot, blau
          5000: { primary: { hue: 46920, bri: 140, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 130, sat: 255, fade: 10 }, processed: false }, // rot, blau
          5500: { primary: { hue: 46920, bri: 020, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 020, sat: 255, fade: 10 }, processed: false }, // rot, blau
          6000: { primary: { hue: 46920, bri: 090, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 090, sat: 255, fade: 10 }, processed: false }, // rot, blau
          6500: { primary: { hue: 46920, bri: 030, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 030, sat: 255, fade: 10 }, processed: false }, // rot, blau
          7000: { primary: { hue: 46920, bri: 040, sat: 255, fade: 10 }, ambient: { hue: 46920, bri: 040, sat: 255, fade: 10 }, processed: false }, // rot, blau
          
          7500: { primary: { on: false }, ambient: { on: false }, processed: false }, // alles aus
          7750: { primary: { on: true }, ambient: { on: false }, processed: false }, // links an und spricht, rechts ist aus
          8000: { primary: { hue: 00000, bri: 180, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
          8500: { primary: { hue: 00400, bri: 120, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
          9000: { primary: { hue: 00000, bri: 190, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
          9500: { primary: { hue: 00400, bri: 130, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
         10000: { primary: { hue: 00000, bri: 140, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
         10500: { primary: { hue: 00400, bri: 110, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
         11000: { primary: { hue: 00000, bri: 255, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
         11250: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 000, fade: 10 }, processed: false }, // rot, blau
         11500: { primary: { hue: 00400, bri: 255, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 255, fade: 10 }, processed: false }, // rot, blau
         11750: { primary: { hue: 00400, bri: 050, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 255, fade: 10 }, processed: false }, // rot, blau
         12000: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 0, bri: 000, sat: 255, fade: 10 }, processed: false }, // rot, blau
         
         12250: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { on: true, hue: 56100, bri: 180, sat: 255, fade: 10 }, processed: false }, // rechts spricht!
         12500: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 180, sat: 255, fade: 10 }, processed: false }, // rot, blau
         13000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 120, sat: 255, fade: 10 }, processed: false }, // rot, blau
         13500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 190, sat: 255, fade: 10 }, processed: false }, // rot, blau
         14000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 130, sat: 255, fade: 10 }, processed: false }, // rot, blau
         14500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 140, sat: 255, fade: 10 }, processed: false }, // rot, blau
         15000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 110, sat: 255, fade: 10 }, processed: false }, // rot, blau
         15500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 180, sat: 255, fade: 10 }, processed: false }, // rot, blau
         16000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 120, sat: 255, fade: 10 }, processed: false }, // rot, blau
         16500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 190, sat: 255, fade: 10 }, processed: false }, // rot, blau
         17000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 130, sat: 255, fade: 10 }, processed: false }, // rot, blau
         17500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 140, sat: 255, fade: 10 }, processed: false }, // rot, blau
         18000: { primary: { hue: 00400, bri: 180, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 000, sat: 255, fade: 10 }, processed: false }, // links spricht
         18500: { primary: { hue: 00000, bri: 120, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 000, sat: 255, fade: 10 }, processed: false }, // 
         19000: { primary: { hue: 00400, bri: 190, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 000, sat: 255, fade: 10 }, processed: false }, // 
         19500: { primary: { hue: 00000, bri: 130, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 000, sat: 255, fade: 10 }, processed: false }, // 
         20000: { primary: { hue: 00400, bri: 140, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 000, sat: 255, fade: 10 }, processed: false }, // 
         
         20500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 190, sat: 255, fade: 10 }, processed: false }, // rechts
         21000: { primary: { hue: 00400, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 130, sat: 255, fade: 10 }, processed: false }, // 
         21500: { primary: { hue: 00000, bri: 000, sat: 255, fade: 10 }, ambient: { hue: 56100, bri: 140, sat: 255, fade: 10 }, processed: false }, // 
         
         
        }
        
        $("audio").on('timeupdate', function () {
          var timeCode = (((this.currentTime * 1000)/250).toFixed() * 250);
          console.log(timeCode);
          var color = colors[timeCode];
          if(color) {
            if(!color.processed) {
              setLightState(1, color.primary);
              setLightState(2, color.ambient);
              color.processed = true;
            }
          }
          
          // var colorData = colors[this.currentTime.toFixed() * 1000];
          // if(colorData) {
          //   if(!colorData.processed) {
          //     
          //     if( ) {
          //       setLightState(1, colorData.primary);
          //       setLightState(2, colorData.ambient);
          //     }
          //     
          //     // if(colors[(this.currentTime.toFixed() - 1000)/1000] && colors[(this.currentTime.toFixed() - 1000)/1000].transition == 1) {
          //     //   console.log("fade!")
          //     //   setLightState(1, colorData.primary);
          //     //   setLightState(2, colorData.ambient);
          //     // } else {
          //     //   console.log("hard!")
          //     //   setLightState(1, colorData.primary);
          //     //   setLightState(2, colorData.ambient);
          //     // }
          //     colorData.processed = true;
          //     console.log('timeupdate', this.currentTime);
          //   }
          // }
        });
        
        $("audio").on('seeked', function () {
          for(var k in colors) {
            colors[k].processed = false;
          }
        });
        
      });
    </script>
    <style type="text/css" media="screen">
      html, body {
        background-color: black;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      body {
        background-color: black;
      }
      
      audio {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
      }
      
      .primary {
        width: 50%;
        height: 100%;
        background-color: black;
        float: left;
      }
      .ambient {
        width: 50%;
        height: 100%;
        background-color: black;
        float: left;
      }
      
    </style>
  </head>
  <body>
    <audio controls="controls" style="width: 100%">
      <source src="xenia.mp3" />
      
    </audio>
    
    <div class="primary">
    </div>
    <div class="ambient">
    </div>
    
  </body>
</html>